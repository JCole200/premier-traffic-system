// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-1.0.x", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "sqlite"
  // Reverting to standard DATABASE_URL for maximum compatibility
  // If using Vercel Postgres, ensure the connection string is assigned to DATABASE_URL in the dashboard.
  url       = env("DATABASE_URL") 
}

model InventoryItem {
  id            String @id // e.g. 'audio-podcast-unbelievable'
  name          String
  type          String // 'AUDIO', 'DISPLAY', 'EMAIL'
  totalCapacity Int
  unit          String
  bookings      Booking[]
}

model Booking {
  id                 String   @id @default(uuid())
  clientName         String
  campaignName       String
  startDate          DateTime
  endDate            DateTime
  status             String   @default("CONFIRMED")
  isBlocked          Boolean  @default(false)
  
  // New Fields
  contractNumber     String?
  bookerName         String?
  bookingType        String?  // 'AUDIO', 'DISPLAY', 'BESPOKE_ESEND', 'ADS_IN_ESEND'
  department         String   @default("SALES") // SALES, MARKETING, FUNDRAISING, INTERNAL
  additionalDetails  String?  // JSON string for extra fields (targeting, websites, etc.)

  // Inventory Requests
  audioSpots         Int      @default(0)
  displayImpressions Int      @default(0)
  
  // Relations
  audioTargetId      String?
  audioTarget        InventoryItem? @relation(fields: [audioTargetId], references: [id])
  
  emailDates         String?  // Storing as JSON string for SQLite simplicity: "['2026-01-01', ...]"
  geoTarget          String   @default("GLOBAL")
  
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}
